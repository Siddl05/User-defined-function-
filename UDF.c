#include "udf.h"

const double MW_H2 = 2.016;
const double MW_H2O = 18.01534;
const double MW_O2 = 31.99880;
const double MW_CH4 = 16.04303;
const double MW_C6H6 = 78.11;
const double MW_CO = 28.01055;
const double MW_CO2 = 44.00995;
const double MW_SO2 = 64.06480;
const double MW_N2 = 28.01340;
const double MW_H2S = 34.1;
const double MW_COS = 60.07;
const double MW_AR = 39.98;

int Cell_Based = 1;

/* Case 1: Absorption coefficients values from HITEMP database */

double absH2O[288] = { 12.3491,25.0962,38.0945,51.2553,64.5218,131.513,198.626,265.273,331.595,657.398,973.238,1282.34,6.6293,13.5574,15.7043,27.8747,35.1673,72.2195,109.613,147.04,
                       184.41,368.663,548.549,725.629,4.32543,8.88454,13.5701,18.3342,23.1525,47.6606,72.4221,97.2268,122.002,244.721,365.818,485.6,3.06246,6.31552,9.66523,13.0697,
                       16.5097,33.9618,51.5112,69.01,86.4501,172.973,258.881,344.179,2.26578,4.69682,7.20517,9.75122,12.3171,25.2252,38.0686,50.8395,63.5711,126.882,189.819,252.522,
                       1.74041,3.61685,5.5528,7.51384,9.48312,19.2888,28.9856,38.6268,48.2374,95.9926,143.37,190.482,1.36947,2.85495,4.38466,5.92618,7.46715,15.0686,22.5779,30.049,
                       37.4935,74.4256,111.022,147.391,1.10251,2.30074,3.52957,4.75879,5.98357,12.0145,17.9718,23.8912,29.7837,58.9561,87.7975,116.433,0.899846,1.87865,2.87884,3.87864,
                       4.87292,9.75571,14.564,19.3331,24.0737,47.4895,70.6037,93.5375,0.747136,1.55844,2.38507,3.2117,4.03186,8.04509,11.9858,15.8877,19.761,38.8364,57.6284,76.2613,
                       0.628638,1.30887,2.0009,2.69216,3.37627,6.71236,9.9786,13.2068,16.4068,32.1425,47.6266,62.9726,0.5339,1.11012,1.696,2.28026,2.85707,5.66204,8.40125,11.1033,
                       13.778,26.9083,39.8177,52.6108,0.457547,0.950408,1.45139,1.94996,2.44151,4.82468,7.14717,9.43399,11.6955,22.7813,33.6805,44.4861,0.395597,0.820831,1.25231,
                       1.68074,2.10277,4.14532,6.13234,8.08675,10.0178,19.4777,28.7762,37.9985,0.344374,0.713807,1.08774,1.45848,1.82343,3.58866,5.30393,6.98973,8.65477,16.8086,24.825,
                       32.7802,0.301499,0.624425,0.950597,1.27361,1.59168,3.12937,4.62211,6.08855,7.53661,14.6273,21.6003,28.5218,0.26518,0.548866,0.834929,1.11805,1.39698,2.74508,
                       4.041075,5.33707,6.60514,12.8137,18.9202,24.9834,0.234328,0.48475,0.736937,0.98643,1.23231,2.42056,3.57277,4.70411,5.82103,11.2906,16.6716,22.0157,0.234328,0.48475,
                       0.736937,0.98643,1.23231,2.42056,3.57277,4.70411,5.82103,11.2906,16.6716,22.0157,0.234328,0.48475,0.736937,0.98643,1.23231,2.42056,3.57277,4.70411,5.82103,11.2906,
                       16.6716,22.0157,0.234328,0.48475,0.736937,0.98643,1.23231,2.42056,3.57277,4.70411,5.82103,11.2906,16.6716,22.0157,0.234328,0.48475,0.736937,0.98643,1.23231,2.42056,
                       3.57277,4.70411,5.82103,11.2906,16.6716,22.0157,0.234328,0.48475,0.736937,0.98643,1.23231,2.42056,3.57277,4.70411,5.82103,11.2906,16.6716,22.0157,0.234328,0.48475,  
                       0.736937,0.98643,1.23231,2.42056,3.57277,4.70411,5.82103,11.2906,16.6716,22.0157};

double absCO[144] = { 0.192197,0.384393,0.960985,1.92197,4.80497,9.61004,0.593803,1.18761,2.96902,5.93803,14.8451,29.6903,0.910059,1.82012,4.5503,9.10059,22.7515,45.503,1.02587,2.05175,
                      5.12937,10.2587,25.6468,51.2936,0.99538,1.99076,4.9769,9.95379,24.8845,49.7689,0.893653,1.78731,4.46826,8.93653,22.3414,44.6826,0.770041,1.54008,3.8502,7.70042,
                      19.251,38.502,0.649504,1.29901,3.24752,6.49503,16.2376,32.4752,0.542243,1.08449,2.71122,5.42243,13.5561,27.1121,0.450967,0.901935,2.25484,4.50967,11.2742,22.5483,
                      0.375036,0.750073,1.87518,3.75037,9.37591,18.7518,0.312564,0.625128,1.56282,3.12564,7.8141,15.6282,0.261389,0.522778,1.30694,2.61389,6.53472,13.0694,0.219486,0.438972,
                      1.09743,2.19486,5.48715,10.9743,0.18511,0.37022,0.925549,1.85109,4.62774,9.25547,0.156814,0.313628,0.784069,1.56814,3.92035,7.84069,0.133427,0.266855,0.667135,1.33427,
                      3.33568,6.67136,0.11401,0.228021,0.570051,1.1401,2.85026,5.70051,0.11401,0.228021,0.570051,1.1401,2.85026,5.70051,0.11401,0.228021,0.570051,1.1401,2.85026,5.70051,
                      0.11401,0.228021,0.570051,1.1401,2.85026,5.70051,0.11401,0.228021,0.570051,1.1401,2.85026,5.70051,0.11401,0.228021,0.570051,1.1401,2.85026,5.70051,0.11401,0.228021,
                      0.570051,1.1401,2.85026,5.70051 };

double absCO2[144] = { 36.1452,72.2901,180.724,361.442,542.153,722.858,35.9913,71.9826,179.956,359.912,539.868,719.823,42.6436,85.2872,213.218,426.436,639.655,852.874,46.51,93.02,232.55,
                       465.1,697.649,930.199,45.8339,91.6677,229.169,458.338,687.507,916.675,42.1467,84.2934,210.733,421.466,632.199,842.931,37.1544,74.3087,185.772,371.543,557.314,743.085,
                       31.9584,63.9168,159.792,319.583,479.374,639.165,27.1185,54.237,135.592,271.184,406.776,542.368,22.8569,45.7137,114.284,228.568,342.852,457.135,19.2167,38.4335,96.0837,
                       192.167,288.25,384.333,16.1582,32.3164,80.7909,161.582,242.372,323.163,13.6095,27.219,68.0475,136.095,204.142,272.189,11.4927,22.9854,57.4635,114.927,172.39,229.853,
                       9.7349,19.4698,48.6744,97.3488,146.023,194.697,8.2726,16.5452,41.363,82.7259,124.089,165.451,7.05254,14.1051,35.2627,70.5253,105.788,141.05,6.03092,12.0618,30.1546,
                       60.309,90.4635,120.618,6.03092,12.0618,30.1546,60.309,90.4635,120.618,6.03092,12.0618,30.1546,60.309,90.4635,120.618,6.03092,12.0618,30.1546,60.309,90.4635,120.618,
                       6.03092,12.0618,30.1546,60.309,90.4635,120.618,6.03092,12.0618,30.1546,60.309,90.4635,120.618,6.03092,12.0618,30.1546,60.309,90.4635,120.618};

double T[18] = {300,400,500,600,700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800,1900,2000};

double moleH2O[12] = {0.01,0.02,0.03,0.04,0.05,0.1,0.15,0.2,0.25,0.5,0.75,1};
double moleCO[6] = {0.01,0.02,0.05,0.1,0.25,0.5};
double moleCO2[6] = {0.05,0.1,0.25,0.5,0.75,1};

DEFINE_PROPERTY(user_absorp_coeff, c, t)
{
double Y_H2=0, Y_H2O=0, Y_O2=0, Y_CH4=0, Y_C6H6=0, Y_CO=0, Y_CO2=0, Y_SO2=0, Y_N2=0, Y_H2S, Y_COS, Y_AR;
double X_H2=0, X_H2O=0, X_O2=0, X_CH4=0, X_C6H6=0, X_CO=0, X_CO2=0, X_SO2=0, X_N2=0, X_H2S, X_COS, X_AR;
double Y_sum, MW_mix,aH2O,aCO,aCO2;
double Tg,wm,wt,absH2Omprev,absH2Ompost,absCOmprev,absCOmpost,absCO2mprev,absCO2mpost;
int iter,mH2O=0,mCO=0,mCO2=0,it,it1;
double absorption_coefficient ;

Y_O2 = C_YI(c,t,1);
Y_CO2 = C_YI(c,t,2);
Y_H2O = C_YI(c,t,3);
Y_CO = C_YI(c,t,5);
Y_SO2 = C_YI(c,t,6);
Y_N2 = C_YI(c,t,7);
Y_CH4 = C_YI(c,t,8);
Y_AR = C_YI(c,t,9);
Y_H2 = C_YI(c,t,10);
Y_C6H6 = C_YI(c,t,11);
Y_COS = C_YI(c,t,12);
Y_H2S = C_YI(c,t,13);

Y_sum = Y_H2 + Y_H2O + Y_O2 + Y_CH4 + Y_C6H6 + Y_CO + Y_CO2 + Y_SO2 + Y_N2 + Y_H2S + Y_COS+ Y_AR;
if (Y_sum != 1.0)
{
Y_H2 = Y_H2 / Y_sum;
Y_H2O = Y_H2O / Y_sum;
Y_O2 = Y_O2 / Y_sum;
Y_CH4 = Y_CH4 / Y_sum;
Y_C6H6 = Y_C6H6 / Y_sum;
Y_CO = Y_CO / Y_sum;
Y_CO2 = Y_CO2 / Y_sum;
Y_SO2 = Y_SO2 / Y_sum;
Y_N2 = Y_N2 / Y_sum;
Y_H2S = Y_H2S / Y_sum;
Y_COS = Y_COS / Y_sum;
Y_AR = Y_AR / Y_sum;
}
MW_mix = Y_H2/MW_H2 + Y_H2O/MW_H2O + Y_O2/MW_O2 + Y_CH4/MW_CH4 + Y_C6H6/MW_C6H6+ Y_CO/MW_CO+ Y_CO2/MW_CO2 + Y_SO2/MW_SO2 + Y_N2/MW_N2;
MW_mix = MW_mix + Y_H2S/MW_H2S + Y_COS/MW_COS + Y_AR/MW_AR;
MW_mix = 1.0/MW_mix;

X_H2O = Y_H2O * MW_mix / MW_H2O;
X_CO = Y_CO * MW_mix / MW_CO;
X_CO2 = Y_CO2 * MW_mix / MW_CO2;

Tg = C_T(c,t);

{iter = ( Tg - 300 )/100;

if(Tg < 300)
{
 Tg = 300;
}

if(Tg > 2000)
{
 Tg = 2000;
} 

while((X_H2O - moleH2O[mH2O])>= 0)
{
  mH2O++;
}
mH2O--;

wm = (X_H2O - moleH2O[mH2O])/( moleH2O[mH2O+1] - moleH2O[mH2O] );
it = (iter*12)+ mH2O;
it1 = ((iter+1)*12) + mH2O;
absH2Omprev =  absH2O[it] + wm*(absH2O[it+1] - absH2O[it]);
absH2Ompost =  absH2O[it1] + wm*(absH2O[it1+1] - absH2O[it1]);

wt= (Tg - T[iter])/(T[iter+1] - T[iter]);

aH2O= absH2Omprev + (wt*(absH2Ompost- absH2Omprev));

it=0,it1=0,wm=0;
while((X_CO - moleCO[mCO])>= 0)
{
  mCO++;
}
mCO--;

wm = (X_CO - moleCO[mCO])/( moleCO[mCO+1] - moleCO[mCO] );
it = (iter*6)+ mCO;
it1 = ((iter+1)*6)+ mCO;
absCOmprev =  absCO[it] + wm*(absCO[it+1] - absCO[it]);
absCOmpost =  absCO[it1] + wm*(absCO[it1+1] - absCO[it1]);

aCO= absCOmprev + (wt*(absCOmpost- absCOmprev));

it=0,it1=0,wm=0;
while((X_CO2 - moleCO[mCO2])>= 0)
{
  mCO2++;

}
mCO2--;

wm = (X_CO2 - moleCO[mCO2])/( moleCO2[mCO2+1] - moleCO2[mCO2] );
it = (iter*6)+ mCO2;
it1 = ((iter+1)*6)+ mCO2;
absCO2mprev =  absCO2[it] + wm*(absCO2[it+1] - absCO2[it]);
absCO2mpost =  absCO2[it1] + wm*(absCO2[it1+1] - absCO2[it1]);

aCO2= absCO2mprev + (wt*(absCO2mpost- absCO2mprev));


absorption_coefficient = aH2O + aCO + aCO2;

return (real)(absorption_coefficient);
}
